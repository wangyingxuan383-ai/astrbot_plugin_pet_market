# 🐾 AstrBot 插件：宠物市场

把群友变成宠物，开启养成、打工、训练、银行、PK决斗、进化、排行榜的完整互动游戏！

![AstrBot](https://img.shields.io/badge/AstrBot-v4.5.7+-blue)
![Version](https://img.shields.io/badge/Version-v2.3.7-green)

---

## ✨ 功能特性

- 🐾 **购买/放生宠物** - 把群友变成你的宠物，放生返还30%身价
- 💍 **赎身系统** - 宠物可支付身价赎身获得自由+24小时保护期
- 🏠 **公寓系统** - 购买/租房扩容，超额自动放生
- 💼 **打工赚钱** - 派遣所有宠物批量打工获取金币（含主人抽成）
- 🧠 **训练&进化** - 单个训练或一键训练，进化提升成长
- ⚔️ **PK 决斗** - 宠物对战，赢家掠夺 10% 身价
- 🏦 **银行&贷款** - 存款、取款、复利利息、贷款/还款
- 📈 **金融市场** - 基金/股票/虚拟币投资与持仓
- 🛒 **商店道具** - 购买/使用道具、背包系统
- 🎫 **签到&彩票** - 每日签到与双色球玩法
- 💸 **转账&抢劫** - 玩家间转账（含手续费）与抢劫系统
- 🏆 **排行榜** - 身价/资金/总资产排名（支持分页）

---

## 🎮 用户指令

| 指令 | 说明 |
|------|------|
| `/宠物菜单` | 查看所有可用指令（图片） |
| `/宠物市场 [页码]` | 查看群内宠物列表（支持分页） |
| `/购买宠物 @群友` | 购买指定群友为宠物 |
| `/放生宠物 @群友` | 放生宠物（返还30%身价、有冷却） |
| `/赎身` | 宠物赎身获得自由（24小时保护期） |
| `/购买公寓` | 购买公寓提升宠物容量 |
| `/租房` | 租借临时公寓（+5容量/7天） |
| `/我的公寓 [编号]` | 查看公寓与入住情况 |
| `/宠物签到` | 每日签到领工资 |
| `/福利彩票 [机选/号码]` | 双色球彩票，以小博大 |
| `/商店` | 查看道具商店 |
| `/购买道具 [ID] [*数量]` | 购买指定道具（可批量） |
| `/我的背包` | 查看背包与道具库存 |
| `/使用道具 [ID] [*数量]` | 使用道具（支持批量） |
| `/打工` | 派遣所有宠物批量打工赚钱 |
| `/逃跑` | 尝试逃离主人 |
| `/训练 @群友` | 训练单只宠物提升身价 |
| `/一键训练` | 批量训练所有宠物 |
| `/进化宠物 @群友` | 消耗金币进化宠物阶段 |
| `/PK @群友` | 宠物决斗（赢家掠夺10%身价） |
| `/我的宠物` | 查看自己的宠物与金币 |
| `/银行信息` | 查看银行等级与利息 |
| `/升级信用` | 提升银行等级与存储上限 |
| `/领取利息` | 领取银行存款利息 |
| `/存款 金额` | 存入金币到银行 |
| `/取款 金额` | 从银行取出金币 |
| `/贷款 金额` | 向银行借款（需支付利息） |
| `/还款 [金额]` | 偿还欠款（不填则还清） |
| `/转账 @群友 金额` | 转账给其他玩家 |
| `/转账记录` | 查看最近10条转账记录 |
| `/抢劫 @群友` | 抢劫其他玩家 |
| `/交罚款` | 抢劫失败后缴纳罚款 |
| `/坐牢` | 抢劫失败后选择坐牢 |
| `/金融帮助` | 查看金融市场操作指南 |
| `/金融市场` | 查看基金/股票/虚拟币大盘 |
| `/买入 [代码] [金额]` | 购买理财产品 |
| `/卖出 [代码] [全部/金额]` | 卖出持仓变现 |
| `/我的持仓` | 查看持仓详情与盈亏 |
| `/宠物身价排行榜 [页码]` | 查看身价排行（支持分页） |
| `/宠物资金排行榜 [页码]` | 查看余额排行（支持分页） |
| `/群内十大首富 [页码]` | 查看总资产排行（支持分页） |

---

## 🔧 管理员指令

| 指令 | 说明 |
|------|------|
| `/我发钱 金额` | 给自己发金币（调试） |
| `/跳过冷却` | 清空自己的所有冷却时间 |
| `/管理员发金币 @用户 金额` | 给他人发金币 |
| `/手动清理` | 立即清理本群所有数据 |
| `/释放监狱 @用户` | 释放用户出监狱 |

---

## ⚙️ 配置说明（WebUI）

| 配置项 | 默认值 | 说明 |
|--------|--------|------|
| `work_cooldown` | 3600 秒 | 打工冷却时间 |
| `train_cooldown` | 86400 秒 | 训练冷却时间 |
| `pk_cooldown` | 3600 秒 | PK 决斗冷却时间 |
| `rob_cooldown` | 3600 秒 | 抢劫冷却时间 |
| `rob_jail_hours` | 24 小时 | 抢劫失败坐牢时间 |
| `transfer_cooldown` | 1800 秒 | 转账冷却时间 |
| `transfer_min_amount` | 100 | 最低转账金额 |
| `transfer_fee_rate` | 0.1 | 转账手续费率 |
| `train_success_rate` | 0.7 | 训练成功率 |
| `train_cost_rate` | 0.1 | 训练费用占身价比例 |
| `bank_initial_limit` | 1000 | 银行初始存储上限 |
| `bank_interest_rate` | 0.01 | 银行每小时利息率（复利） |
| `bank_max_interest_time` | 24 小时 | 最大计息时间 |
| `loan_interest_rate` | 0.05 | 贷款每小时利息率（复利） |
| `loan_limit_per_level` | 5000 | 每级信用等级贷款额度 |
| `loan_interest_max_multiplier` | 1.0 | 强制清算倍率（0 为关闭） |
| `work_tax_rate` | 0.3 | 打工上交主人比例 |
| `escape_success_rate` | 0.3 | 宠物逃跑成功率 |
| `ransom_protection_hours` | 24 小时 | 赎身后保护期 |

---

## 📥 安装方式

### 全新安装
1. 将本插件文件夹放入 AstrBot 的 `plugins/` 目录
2. 重启 AstrBot
3. 群聊发送 `/宠物菜单` 开始游戏

### 升级安装

> ⚠️ **重要提示**：由于Python缓存机制，直接覆盖更新可能导致问题

**推荐方法**（任选其一）：

**方法1：完全重装**（推荐）
1. 在AstrBot管理界面**完全卸载**旧版本插件
2. 删除插件目录下的 `__pycache__` 文件夹
3. 重新安装插件

**方法2：清除缓存**
```bash
# 进入插件目录
cd plugins/Pet-Market

# 删除Python缓存
Remove-Item -Recurse -Force __pycache__
Remove-Item *.pyc

# 重启AstrBot（必须重启，不能只reload）
```

---

## 🧾 数据丢失说明（v2.3.6）

本版本将数据目录规范化为 `data/plugin_data/astrbot_plugin_pet_market/`，旧版本数据仍保留在旧目录（`StarTools.get_data_dir()` 返回的目录）且不会自动迁移，因此升级后可能显示为空。

简单解决方法：
1. 停止 AstrBot
2. 将旧目录内的 `pet_data.yml` 复制到新目录 `data/plugin_data/astrbot_plugin_pet_market/`
3. 重启 AstrBot

---

## 📬 反馈与贡献

- 作者：Antigravity AI
- 提交 Issue 反馈问题
- 加群 1075544978 反馈问题

---

**⭐ 如果好用，请点个 Star 支持！**
